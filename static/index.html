<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>deepelak</title>
    <link rel="stylesheet" href="/static/assets/style/paper.css" />
    <link rel="stylesheet" href="/static/assets/style/style.css" />
  </head>
  <body class="paper">
    <div class="row">
      <div class="card md-4 col margin-right margin-bottom">
        <div class="card-body">
          <h4 class="card-title">DeePelak</h4>
          <h5 class="card-subtitle">interactive ALPR playground</h5>
          <p class="card-text">
            Explore ALPR models in action â€” upload images, tweak settings, and
            compare automatic license plate recognition results instantly.
          </p>
        </div>
      </div>
      <div class="card md-4 col">
        <div class="card-body">
          <div class="row">
            <input id="file" type="file" hidden />
            <input
              id="buttonid"
              type="button"
              class="btn-block btn-secondary-outline"
              value="Upload Car Image"
              onclick="handleFileUpload()"
            />
          </div>
          <div class="separator">
            <h5 class="card-subtitle">Or choose from images below</h5>
          </div>
          <img
            class="thumbnail"
            src="/static/assets/images/samples/car1.jpg"
            onclick="handleThumbnailClick(this)"
          />
        </div>
      </div>
    </div>
    <div class="row">
      <div class="card md-4 col">
        <img id="plate" src="/static/assets/images/samples/car1.jpg" />
      </div>
    </div>
  </body>
  <script>
    const fileInput = document.getElementById("file");
    fileInput.addEventListener("change", function (event) {
      const file = event.target.files[0];
      if (file) {
        uploadImage(file);
      }
    });
    function handleFileUpload() {
      fileInput.click();
    }
    function handleThumbnailClick(img) {
      fetch(img.src)
        .then((res) => res.blob())
        .then((blob) => {
          const file = new File([blob], img.src.split("/").pop(), {
            type: blob.type,
          });
          uploadImage(file);
        });
    }
    async function uploadImage(selectedFile) {
      const formData = new FormData();
      formData.append("file", selectedFile);

      try {
        const response = await fetch("/predict", {
          method: "POST",
          body: formData,
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const blob = await response.blob();
        const imageUrl = URL.createObjectURL(blob);

        console.log("result: ", imageUrl);

        document.getElementById("plate").src = imageUrl;
      } catch (error) {
        console.error("Error: ", error);
      }
    }
  </script>
</html>
